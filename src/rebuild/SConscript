"""Build rebuild library"""


def scons():
    """Execute build"""
    Import('env')

    env.AppendUnique(LIBPATH=[Dir('.')])

    if not env.d_server_requested():
        return

    denv = env.Clone()

    denv.d_add_requires('argobots', 'protobufc', 'hwloc')

    denv.Append(CCFLAGS=['-Wframe-larger-than=131072'])
    # rebuild
    rebuild = denv.d_library('rebuild',
                             ['scan.c', 'srv.c', 'rpc.c', 'ras.c', 'rebuild_iv.c'],
                             install_off="../..")
    denv.Install('$PREFIX/lib64/daos_srv', rebuild)


if __name__ == "SCons.Script":
    scons()
